# Analyse de la structure - Narutopia.fr
## Page: https://narutopia.fr/liste-des-cartes-naruto-kayou/

**Date d'analyse:** 2025-12-11

---

## Résumé Exécutif

- **Total de raretés:** 27 (dont 25 raretés de cartes + 2 catégories accessoires)
- **Total de cartes:** 1853
- **Structure:** Page WordPress avec Elementor
- **Images:** Lazy loading avec attribut `data-src`
- **Caractéristique importante:** Seules des images d'exemple sont présentes sur la page, pas toutes les cartes

---

## Liste Complète des Raretés

| # | Code | Nombre | Description | Section ID |
|---|------|--------|-------------|------------|
| 1 | R | 210 | Découvrez toutes les R de Naruto Kayou | `full-set-r` |
| 2 | SR | 148 | Découvrez toutes les SR de Naruto Kayou | `full-set-sr` |
| 3 | SSR | 189 | Découvrez toutes les SSR de Naruto Kayou | `full-set-ssr` |
| 4 | TR-TGR | 106 (62+44) | Découvrez toutes les TG/TGR de Naruto Kayou | `full-set-tr-tgr` |
| 5 | HR | 220 | Découvrez toutes les HR de Naruto Kayou | `full-set-hr` |
| 6 | PTR | 20 | Découvrez toutes les PTR de Naruto Kayou | `full-set-PTR-S6` |
| 7 | UR | 153 | Découvrez toutes les UR de Naruto Kayou | `full-set-ur` |
| 8 | ZR | 36 | Découvrez toutes les ZR de Naruto Kayou | `full-set-zr` |
| 9 | AR | 80 | Découvrez toutes les AR de Naruto Kayou | `full-set-ar` |
| 10 | OR | 111 | Découvrez toutes les OR de Naruto Kayou | `full-set-or` |
| 11 | SLR | 120 | Découvrez toutes les SLR de Naruto Kayou | `full-set-slr` |
| 12 | CP | 10 | Découvrez toutes les CP de Naruto Kayou | `full-set-cp` |
| 13 | PU | 8 | Découvrez toutes les PU de Naruto Kayou | `full-set-PU` |
| 14 | SP | 84 | Découvrez toutes les SP de Naruto Kayou | *(aucun)* |
| 15 | MR | 72 | Découvrez toutes les MR de Naruto Kayou | `full-set-mr` |
| 16 | GP | 24 | Découvrez toutes les GP de Naruto Kayou | `full-set-gp` |
| 17 | CR | 26 | Découvrez toutes les CR de Naruto Kayou | `full-set-cr` |
| 18 | NR | 23 | Découvrez toutes les NR de Naruto Kayou | `full-set-nr` |
| 19 | BP | 34 | Découvrez toutes les BP de Naruto Kayou | `full-set-bp` |
| 20 | SE | 18 | Découvrez toutes les SE de Naruto Kayou | `full-set-se` |
| 21 | SV | 20 | Découvrez toutes les SV de Naruto Kayou | `full-set-sv` |
| 22 | SCR | 2 | Découvrez les deux SCR du collector Kayou | `full-set-scr` |
| 23 | LR | 6 | Découvrez toutes les LR de Naruto Kayou | `full-set-lr` |
| 24 | PR | 56 | Découvrez toutes les PR de Naruto Kayou | `full-set-pr` |
| 25 | BR | 16 | Découvrez toutes les BR et pin's de Naruto Kayou | *(aucun)* |
| 26 | BADGES OFFICIELS | 48 | Découvrez tous les badges officiels de Naruto Kayou | `full-set-badges` |
| 27 | STYLOS OFFICIELS | 13 | Découvrez tous les stylos officiels de Naruto Kayou | `full-set-stylos-naruto` |

---

## Répartition par Taille

| Plage | Nombre de raretés |
|-------|-------------------|
| 1-10 cartes | 4 raretés |
| 11-50 cartes | 11 raretés |
| 51-100 cartes | 4 raretés |
| 101-150 cartes | 4 raretés |
| 151-200 cartes | 2 raretés |
| 201+ cartes | 2 raretés |

---

## Patterns de Numérotation d'Images

### 1. Pattern Simple (majoritaire)
**Format:** `RARETÉ-NUMÉRO-213x300.webp`

**Exemples:**
- `R-37-213x300.webp` (R #37)
- `SR-123-213x300.webp` (SR #123)
- `SSR-001-213x300.webp` (SSR #1)
- `HR-213x300.webp` (HR - image exemple sans numéro)
- `UR-12-213x300.webp` (UR #12)
- `ZR-1-213x300.webp` (ZR #1)
- `AR-029-213x300.webp` (AR #29)
- `OR-7-213x300.webp` (OR #7)
- `CP-001-213x300.webp` (CP #1)
- `SP-9-213x300.webp` (SP #9)
- `MR-12-213x300.webp` (MR #12)
- `GP-020-213x300.webp` (GP #20)
- `CR-020-213x300.webp` (CR #20)
- `NR-008-213x300.webp` (NR #8)
- `BP-008-213x300.webp` (BP #8)
- `SE-008-213x300.webp` (SE #8)
- `SCR-001-213x300.webp` (SCR #1)
- `LR-002-213x300.webp` (LR #2)
- `PR-044-213x300.webp` (PR #44)
- `BR-014-e1692719802718-208x300.webp` (BR #14 - avec timestamp d'édition)

**Notes:**
- Les numéros peuvent avoir 1 à 3 chiffres (avec ou sans zéros de remplissage)
- Certaines images ont des dimensions différentes (208x300, 215x300)
- Certaines images ont des timestamps d'édition (ex: `-e1692719802718`)

### 2. Pattern Série
**Format:** `NRZ##-RARETÉ-NUMÉRO-213x300.webp`

**Exemples:**
- `NRZ06-PTR-008-213x300.webp` (Série NRZ06, PTR #8)
- `NRZ06-PU-006-215x300.webp` (Série NRZ06, PU #6)

**Notes:**
- `NRZ##` semble être un code de série/extension
- Format: Code série + Rareté + Numéro

### 3. Pattern Variante
**Format:** `TYPE-VARIANTE-NUMÉRO-213x300.webp`

**Exemples:**
- `SV-GOLD-004-213x300.webp` (SV Gold variant #4)

### 4. Pattern Spécial
**Format:** `NOM-SPÉCIAL-213x300.jpg.webp` ou `.webp`

**Exemples:**
- `20TH-ANNIVERSARY-213x300.jpg.webp` (Carte 20ème anniversaire)

### 5. Pattern Sans Numéro
**Format:** `RARETÉ-213x300.webp`

**Exemples:**
- `SR-213x300.webp` (Image exemple générique)
- `SSR-213x300.webp`
- `TGR-213x300.webp`
- `SLR--213x300.webp` (double tiret)

**Note:** Ces images sont probablement des placeholders ou images d'exemple pour chaque rareté

---

## Structure HTML / DOM

### Structure Principale
- **CMS:** WordPress
- **Page Builder:** Elementor
- **Lazy Loading:** Plugin A3 Lazy Load

### Organisation du Contenu
```
section.elementor-section
  └── .elementor-column
      └── .elementor-widget.elementor-widget-image-box
          └── .elementor-image-box-wrapper
              ├── h3.elementor-image-box-title (ex: "R (210)")
              └── p.elementor-image-box-description (ex: "Découvrez toutes les R...")

      └── .elementor-widget.elementor-widget-html[id="full-set-{rarity}"]
          └── Galerie d'images (potentiellement)
```

### Attributs d'Images
- **Source lazy:** `data-src="https://narutopia.fr/wp-content/uploads/..."`
- **Placeholder:** `src="https://narutopia.fr/wp-content/plugins/a3-lazy-load/assets/images/lazy_placeholder.gif"`
- **Alt text:** Généralement vide pour les cartes

---

## Observations Importantes

### 1. Images Incomplètes sur la Page
**Constat:** La page ne contient que 29 images de cartes (exemples), alors qu'elle annonce 1853 cartes.

**Implications:**
- Les galeries complètes ne sont PAS chargées par défaut
- Deux possibilités:
  1. Les galeries se chargent dynamiquement au clic sur les sections
  2. Il faut construire les URLs d'images manuellement selon les patterns

### 2. Section IDs Cliquables
Chaque rareté a un ID de section (ex: `full-set-r`, `full-set-sr`). Ces sections pourraient:
- Charger du contenu dynamiquement au clic
- Contenir des boutons cachés/accordéons
- Rediriger vers d'autres pages

**À tester:** Cliquer sur ces sections pour voir si du contenu se charge

### 3. Numérotation Inconsistante
Les numéros peuvent être:
- Sans zéros de remplissage: `R-37`, `OR-7`
- Avec zéros: `AR-029`, `GP-020`, `CP-001`

**Impact sur le scraping:** Il faudra tester les deux formats pour chaque numéro

---

## Stratégies de Scraping Possibles

### Option 1: Scraping par Construction d'URLs (Recommandé)
Pour chaque rareté:
1. Récupérer le code et le nombre de cartes
2. Pour chaque numéro de 1 à N:
   - Construire les URLs selon tous les patterns possibles
   - Tester chaque URL (HEAD request)
   - Télécharger les images valides

**Avantages:**
- Pas besoin d'explorer toute la page
- Plus rapide et moins de risque de blocage

**Inconvénients:**
- Risque de manquer des cartes si pattern inconnu
- Beaucoup de requêtes HTTP (HEAD + GET)

### Option 2: Scraping par Interaction Dynamique
1. Pour chaque section ID (ex: `full-set-r`)
2. Simuler un clic ou scroll vers la section
3. Attendre le chargement dynamique
4. Extraire toutes les images chargées

**Avantages:**
- Récupère exactement ce que le site fournit
- Pas de construction manuelle d'URLs

**Inconvénients:**
- Plus lent (attente de chargements)
- Peut ne pas charger toutes les images
- Risque de timeout

### Option 3: Recherche d'APIs ou Pages Alternatives
1. Explorer le site pour trouver:
   - API interne (ex: `/wp-json/...`)
   - Pages galeries complètes
   - Sitemap XML
2. Utiliser ces sources directement

**Avantages:**
- Plus fiable et rapide
- Données structurées

**Inconvénients:**
- Nécessite exploration préalable
- Peut ne pas exister

---

## Recommandations

### 1. Test Initial
Avant de scraper toutes les raretés:
1. Tester Option 2 sur une section (ex: `full-set-scr` avec seulement 2 cartes)
2. Vérifier si le clic charge une galerie complète
3. Si oui, utiliser Option 2
4. Si non, utiliser Option 1

### 2. Gestion des Patterns
Pour Option 1, tester dans cet ordre:
1. `RARETÉ-{num}-213x300.webp` (sans zéros)
2. `RARETÉ-{num:03d}-213x300.webp` (avec zéros)
3. Pour PTR/PU: `NRZ06-RARETÉ-{num:03d}-213x300.webp`

### 3. Gestion des Erreurs
- Utiliser HEAD request avant GET pour vérifier existence
- Arrêter après 5-10 404 consécutifs (pas après le premier)
- Logger toutes les URLs testées et leur statut

### 4. Rate Limiting
- Délai de 500ms entre chaque requête
- Délai de 2s entre chaque rareté
- Total estimé: ~2h pour scraper toutes les cartes (1853 cartes × 0.5s/carte)

---

## Données Collectées

### Exemples d'URLs Valides (Confirmées)
```
https://narutopia.fr/wp-content/uploads/2023/08/R-37-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/SR-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/SSR-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/TGR-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/HR-213x300.webp
https://narutopia.fr/wp-content/uploads/2024/09/NRZ06-PTR-008-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/06/UR-12-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/07/ZR-1-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/AR-029-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/OR-7-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/CP-001-213x300.webp
https://narutopia.fr/wp-content/uploads/2024/09/NRZ06-PU-006-215x300.webp
https://narutopia.fr/wp-content/uploads/2023/06/SP-9-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/06/MR-12-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/GP-020-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/CR-020-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/NR-008-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/BP-008-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/SE-008-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/SV-GOLD-004-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/20TH-ANNIVERSARY-213x300.jpg.webp
https://narutopia.fr/wp-content/uploads/2023/05/SCR-001-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/05/LR-002-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/10/PR-044-213x300.webp
https://narutopia.fr/wp-content/uploads/2023/08/BR-014-e1692719802718-208x300.webp
```

---

## Prochaines Étapes

1. ✅ Analyser la structure de la page (TERMINÉ)
2. ⏳ Tester le chargement dynamique sur une section
3. ⏳ Décider de la stratégie (Option 1 ou 2)
4. ⏳ Implémenter le script de scraping
5. ⏳ Tester sur une petite rareté (ex: SCR avec 2 cartes)
6. ⏳ Valider les patterns d'URLs
7. ⏳ Scraper toutes les raretés
8. ⏳ Télécharger et traiter les images
9. ⏳ Intégrer dans la base de données

---

**Rapport généré automatiquement par Puppeteer**
